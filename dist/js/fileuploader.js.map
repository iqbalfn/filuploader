{"version":3,"file":"fileuploader.js","sources":["../../src/js/fileuploader.js"],"sourcesContent":["/**\n * --------------------------------------------------------------------------\n * FileUploader (v0.0.1): fileuploader.js\n * Licensed under MIT (https://github.com/iqbalfn/fileuploader/blob/master/LICENSE)\n * --------------------------------------------------------------------------\n */\n\n/**\n * ------------------------------------------------------------------------\n * Class Definition\n * ------------------------------------------------------------------------\n */\n\nclass FileUploader {\n    constructor(options) {\n        this._queries  = options.queries    || {}\n        this._fields   = options.fields     || {}\n        this._files    = options.files      || {}\n        this._headers  = options.headers    || {}\n        this._url      = options.url\n        this._response = null\n        this._xhr      = null\n\n        // events\n        let events = ['onStart', 'onProgress', 'onError', 'onSuccess', 'onComplete']\n        events.forEach(i => {\n            if(options[i])\n                this[i] = options[i]\n        })\n    }\n\n    // events callback\n    onStart(){}\n    onProgress(){}\n    onError(){}\n    onSuccess(){}\n    onComplete(){}\n\n    // public\n\n    // actions\n\n    getResponse(){\n        return this._response\n    }\n\n    send(){\n        let formData = new FormData(),\n            xhr      = new XMLHttpRequest()\n\n        this._xhr = xhr\n\n        for(let field in this._fields)\n            formData.append(field, this._fields[field])\n\n        for(let field in this._files)\n            formData.append(field, this._files[field], this._files[field].name);\n\n        let url     = this._url\n        let usign   = url.includes('?') ? '&' : '?'\n        let queries = []\n        for(let k in this._queries)\n            queries.push( this._qs(k) + '=' + this._qs(this._queries[k]))\n\n        if(queries.length)\n            url+= usign + queries\n\n        xhr.open('POST', url, true);\n\n        xhr.onreadystatechange = () => {\n            this.onProgress(this, xhr.readyState)\n\n            if(xhr.readyState != 4)\n                return\n            \n            if(xhr.status != 200){\n                this.onError(this, this._xhr)\n                this.onComplete(this, this._xhr)\n                return\n            }\n\n            let res = null\n\n            try{\n                res = JSON.parse(xhr.responseText)\n            }catch(e){\n                res = xhr.responseText\n            }\n\n            this.onSuccess(this, this._xhr, res)\n            this.onComplete(this, this._xhr)\n        }\n\n        xhr.send(formData);\n        this.onStart(this, this._xhr)\n    }\n\n    // setter & adder\n    addField(name, value){\n        this._fields[name] = value\n    }\n\n    addFile(name, value){\n        this._files[name] = value\n    }\n\n    addHeader(name, value){\n        this._headers[name] = value\n    }\n\n    addQuery(name, value){\n        this._queries[name] = value\n    }\n\n    setUrl(url){\n        this._url = url\n    }\n\n    // getter\n    getUrl(){\n        return this._url\n    }\n\n    getField(name){\n        return this._fields[name]\n    }\n\n    getFields(){\n        return this._fields\n    }\n\n    getFile(name){\n        return this._files[name]\n    }\n\n    getFiles(){\n        return this._files\n    }\n\n    getHeader(name){\n        return this._headers[name]\n    }\n\n    getHeaders(){\n        return this._headers\n    }\n\n    getQuery(name){\n        return this._queries[name]\n    }\n\n    getQueries(){\n        return this._queries\n    }\n\n    // private\n\n    _qs(str){\n        return encodeURIComponent(str)\n    }\n}\n\nwindow.FileUploader = FileUploader\n\nexport default FileUploader"],"names":["FileUploader","options","_queries","queries","_fields","fields","_files","files","_headers","headers","_url","url","_response","_xhr","events","forEach","i","onStart","onProgress","onError","onSuccess","onComplete","getResponse","send","formData","FormData","xhr","XMLHttpRequest","field","append","name","usign","includes","k","push","_qs","length","open","onreadystatechange","readyState","status","res","JSON","parse","responseText","e","addField","value","addFile","addHeader","addQuery","setUrl","getUrl","getField","getFields","getFile","getFiles","getHeader","getHeaders","getQuery","getQueries","str","encodeURIComponent","window"],"mappings":"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"}